// Generated by CoffeeScript 1.6.3
var __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

define(['chaplin', 'models/base/collection'], function(Chaplin, Collection) {
  'use strict';
  var PageableCollection;
  return PageableCollection = (function(_super) {
    __extends(PageableCollection, _super);

    function PageableCollection() {
      this.pagination.currentPage = 0;
      PageableCollection.__super__.constructor.apply(this, arguments);
    }

    PageableCollection.prototype.pagination = {
      pageSize: 20,
      totalPages: 0,
      totalItems: 0,
      currentPage: 0
    };

    PageableCollection.prototype.fetch = function(options) {
      var success, _ref;
      Chaplin.mediator.publish('before:fetch');
      if (options == null) {
        options = {};
      }
      options.data = _.extend({
        page: this.pagination.currentPage,
        perpage: this.pagination.pageSize
      }, (_ref = options.data) != null ? _ref : {});
      success = options.success;
      options.success = function(resp) {
        Chaplin.mediator.publish('after:fetch');
        if (success) {
          return success(resp, options);
        }
      };
      return PageableCollection.__super__.fetch.call(this, options);
    };

    PageableCollection.prototype.parse = function(data) {
      this.pagination.totalItems = data.total;
      this.pagination.totalPages = Math.ceil(this.pagination.totalItems / this.pagination.pageSize);
      return data.data;
    };

    PageableCollection.prototype.prevPage = function() {
      if (this.pagination.currentPage <= 0) {
        return false;
      }
      this.pagination.currentPage--;
      return this.fetch({
        add: true,
        remove: false
      });
    };

    PageableCollection.prototype.nextPage = function() {
      if (this.pagination.currentPage >= this.pagination.totalPages) {
        return false;
      }
      this.pagination.currentPage++;
      return this.fetch({
        add: true,
        remove: false
      });
    };

    PageableCollection.prototype.hasNextPage = function() {
      return this.pagination.currentPage + 1 < this.pagination.totalPages;
    };

    return PageableCollection;

  })(Collection);
});
